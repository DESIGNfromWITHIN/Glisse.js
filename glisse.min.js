/*
* jQuery Glisse plugin
* ---
* @author: Victor
* @authorurl: http://victorcoulon.fr
* @twitter: http://twitter.com/_victa
*
* Based on jQuery Plugin Boilerplate 1.3
*
*/
(function(a){a.glisse=function(b,d){var e=this;e.settings={};e.els={};var p=a(b);var k={dataName:"data-glisse-big",speed:300,changeSpeed:1000,effect:"bounce",mobile:false};var m,i,u=false,h={};e.init=function(){e.settings=a.extend({},k,d);a.MobileDevice=((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/Android/i)));a.Tablet=((navigator.userAgent.match(/iPad/i)));m=a(p).attr(e.settings.dataName);i=p.attr("rel")||null;e.settings.mobile=(a.Tablet||a.MobileDevice)?true:false;p.on("click",function(){o();q();l(m);g();j();a(document).keydown(function(v){if(v.keyCode.toString()==="27"){c()}if(v.keyCode.toString()==="39"){n("next")}if(v.keyCode.toString()==="37"){n("prev")}});if(e.settings.mobile){mobile={touching:false,nx:0,oX:0,scrollX:null};document.ontouchmove=function(v){s(v)};document.ontouchstart=function(v){s(v)};document.ontouchend=function(v){s(v)}}})};var o=function o(){p.addClass("active");var w=r("transition")+"transition",v="opacity "+e.settings.speed+"ms ease, "+r("transform")+"transform "+e.settings.speed+"ms ease";e.els.overlay=a(document.createElement("div")).attr("id","glisse-overlay").css(w,v);e.els.spinner=a(document.createElement("div")).attr("id","glisse-spinner");e.els.close=a(document.createElement("span")).attr("id","glisse-close").css(w,v);e.els.content=a(document.createElement("div")).attr("id","glisse-overlay-content").css(w,v).css(r("transform")+"transform","scale(0)");e.els.controls=a(document.createElement("div")).attr("id","glisse-controls").css(w,v);e.els.controlNext=a(document.createElement("span")).attr("class","glisse-next").append(a(document.createElement("a")).html("&#62;").attr("href","#"));e.els.controlLegend=a(document.createElement("span")).attr("class","glisse-legend");e.els.controlPrev=a(document.createElement("span")).attr("class","glisse-prev").append(a(document.createElement("a")).html("&#60;").attr("href","#"));e.els.overlay.append(e.els.spinner);e.els.controls.append(e.els.controlNext,e.els.controlLegend,e.els.controlPrev);a("body").append(e.els.overlay,e.els.close,e.els.content,e.els.controls);t.observe("glisse-overlay",function(){e.els.overlay.css("opacity",1)});t.observe("glisse-close",function(){e.els.close.css("opacity",1)});t.observe("glisse-controls",function(){e.els.controls.css("opacity",1)});e.els.controls.delegate("a","click",function(x){x.preventDefault();var y=(a(this).parent().hasClass("glisse-next"))?"next":"prev";n(y)});e.els.overlay.on("click",function(){c()});e.els.content.on("click",function(){c()});e.els.close.on("click",function(){c()})};var c=function c(){e.els.content.css({opacity:0}).css(r("transform")+"transform","scale(1.2)");e.els.overlay.css({opacity:0});e.els.close.css({opacity:0});e.els.controls.css({opacity:0});setTimeout(function(){e.els.content.remove();e.els.overlay.remove();e.els.close.remove();e.els.controls.remove();a("#glisse-transition-css").remove()},e.settings.speed);m=a(p).attr(e.settings.dataName);p.removeClass("active");document.ontouchmove=function(v){return true};document.ontouchstart=function(v){return true};document.ontouchend=function(v){return true};a(document).unbind("keydown")};var l=function l(x){f(true);var w=x+"?"+Math.random(),v=a("<img/>",{src:w}).appendTo(e.els.content);e.els.content.css({backgroundImage:"url("+w+")"});v.load(function(){v.remove();f(false);e.els.content.css({visibility:"visible",opacity:1}).css(r("transform")+"transform","scale(1)")})};var n=function n(B){var y=a('img[data-glisse-big="'+m+'"]'),w=a("img[rel="+i+"]").index(y),z=a("img[rel="+i+"]").length,C=true;if((w===0&&B==="prev")||(w===(z-1)&&B==="next")){C=false}if(C&&u===false){u=true;var x=(B==="next")?a("img[rel="+i+"]").eq(w+1):a("img[rel="+i+"]").eq(w-1);if(e.settings.mobile){if(B!=="next"){e.els.content.css(r("transform")+"transform","translateX(2000px)")}else{e.els.content.css(r("transform")+"transform","translateX(-2000px)")}}else{e.els.content.addClass("glisse-transitionOut-"+B);var A=r("transition")+"transition",v="opacity "+e.settings.speed+"ms ease, "+r("transform")+"transform "+e.settings.speed+"ms ease";e.els.content.css(A,"")}f(true);y.removeClass("active");x.addClass("active");m=x.attr(e.settings.dataName);g();j();setTimeout(function(){if(e.settings.mobile){e.els.content.css(r("transform")+"transform","translateX(0px)").css("display","none")}var E=m+"?"+Math.random(),D=a("<img/>",{src:E}).appendTo(e.els.content);e.els.content.css({backgroundImage:"url("+E+")"});D.load(function(){D.remove();f(false);if(e.settings.mobile){e.els.content.css("display","block")}e.els.content.removeClass("glisse-transitionOut-"+B).addClass("glisse-transitionIn-"+B);setTimeout(function(){e.els.content.removeClass("glisse-transitionIn-"+B).css(A,v);u=false},e.settings.changeSpeed)})},e.settings.changeSpeed)}else{if(C===false&&u===false){if(e.settings.mobile){e.els.content.css(r("transform")+"transform","translateX(0px)")}e.els.content.addClass("shake");setTimeout(function(){e.els.content.removeClass("shake")},600)}}};var q=function q(){var x=r("transform");var y=r("animation");var v=[];switch(e.settings.effect){case"bounce":v=["@"+y+"keyframes outLeft {","0% { "+x+"transform: translateX(0);}","20% { opacity: 1;"+x+"transform: translateX(20px);}","100% { opacity: 0;"+x+"transform: translateX(-2000px);}","}","@"+y+"keyframes inLeft {","0% {opacity: 0;"+x+"transform: translateX(-2000px);}","60% {opacity: 1;"+x+"transform: translateX(30px);}","80% {"+x+"transform: translateX(-10px);}","100% {"+x+"transform: translateX(0);}","}","@"+y+"keyframes outRight {","0% {"+x+"transform: translateX(0);}","20% {opacity: 1;"+x+"transform: translateX(-20px);}","100% {opacity: 0;"+x+"transform: translateX(2000px);}","}","@"+y+"keyframes inRight {","0% {opacity: 0;"+x+"transform: translateX(2000px);}","60% {opacity: 1;"+x+"transform: translateX(-30px);}","80% {"+x+"transform: translateX(10px);}","100% {"+x+"transform: translateX(0);}","}"].join("");break;case"fadeBig":v=["@"+y+"keyframes outLeft {","0% { opacity: 1;"+x+"transform: translateX(0);}","100% {opacity: 0;"+x+"transform: translateX(-2000px);}","}","@"+y+"keyframes inLeft {","0% { opacity: 0;"+x+"transform: translateX(-2000px);}","100% {opacity: 1;"+x+"transform: translateX(0);}","}","@"+y+"keyframes outRight {","0% { opacity: 1;"+x+"transform: translateX(0);}","100% {opacity: 0;"+x+"transform: translateX(2000px);}","}","@"+y+"keyframes inRight {","0% { opacity: 0;"+x+"transform: translateX(2000px);}","100% {opacity: 1;"+x+"transform: translateX(0);}","}"].join("");break;case"fade":v=["@"+y+"keyframes outLeft {","0% { opacity: 1;"+x+"transform: translateX(0);}","100% {opacity: 0;"+x+"transform: translateX(-200px);}","}","@"+y+"keyframes inLeft {","0% { opacity: 0;"+x+"transform: translateX(-200px);}","100% {opacity: 1;"+x+"transform: translateX(0);}","}","@"+y+"keyframes outRight {","0% { opacity: 1;"+x+"transform: translateX(0);}","100% {opacity: 0;"+x+"transform: translateX(200px);}","}","@"+y+"keyframes inRight {","0% { opacity: 0;"+x+"transform: translateX(200px);}","100% {opacity: 1;"+x+"transform: translateX(0);}","}"].join("");break;case"roll":v=["@"+y+"keyframes outLeft {","0% { opacity: 1;"+x+"transform: translateX(0px) rotate(0deg);}","100% {opacity: 0;"+x+"transform: translateX(-100%) rotate(-120deg);}","}","@"+y+"keyframes inLeft {","0% { opacity: 0;"+x+"transform: translateX(-100%) rotate(-120deg);}","100% {opacity: 1;"+x+"transform:  translateX(0px) rotate(0deg);}","}","@"+y+"keyframes outRight {","0% { opacity: 1;"+x+"transform:translateX(0px) rotate(0deg);}","100% {opacity: 0;"+x+"transform:translateX(100%) rotate(120deg);}","}","@"+y+"keyframes inRight {","0% { opacity: 0;"+x+"transform: translateX(100%) rotate(120deg);}","100% {opacity: 1;"+x+"transform:  translateX(0px) rotate(0deg);}","}"].join("");break;case"rotate":v=["@"+y+"keyframes outRight {","0% { opacity: 1;"+x+"transform: rotate(0deg);"+x+"transform-origin:left bottom;}","100% {opacity: 0;"+x+"transform: rotate(-90deg);"+x+"transform-origin:left bottom;}","}","@"+y+"keyframes inLeft {","0% { opacity: 0;"+x+"transform: rotate(90deg);"+x+"transform-origin:left bottom;}","100% {opacity: 1;"+x+"transform: rotate(0deg);"+x+"transform-origin:left bottom;}","}","@"+y+"keyframes outLeft {","0% { opacity: 1;"+x+"transform: rotate(0deg);"+x+"transform-origin:right bottom;}","100% {opacity: 0;"+x+"transform: rotate(90deg);"+x+"transform-origin:right bottom;}","}","@"+y+"keyframes inRight {","0% { opacity: 0;"+x+"transform: rotate(-90deg);"+x+"transform-origin:right bottom;}","100% {opacity: 1;"+x+"transform: rotate(0deg);"+x+"transform-origin:right bottom;}","}"].join("");break;case"flipX":v=["@"+y+"keyframes outLeft {","0% {"+x+"transform: perspective(400px) rotateX(0deg);opacity: 1;}","100% {"+x+"transform: perspective(400px) rotateX(90deg);opacity: 0;}","}","@"+y+"keyframes inLeft {","0% {"+x+"transform: perspective(400px) rotateX(90deg);opacity: 0;}","40% {"+x+"transform: perspective(400px) rotateX(-10deg);}","70% {"+x+"transform: perspective(400px) rotateX(10deg);}","100% {"+x+"transform: perspective(400px) rotateX(0deg);opacity: 1;}","}","@"+y+"keyframes outRight {","0% {"+x+"transform: perspective(400px) rotateX(0deg);opacity: 1;}","100% {"+x+"transform: perspective(400px) rotateX(90deg);opacity: 0;}","}","@"+y+"keyframes inRight {","0% {"+x+"transform: perspective(400px) rotateX(90deg);opacity: 0;}","40% {"+x+"transform: perspective(400px) rotateX(-10deg);}","70% {"+x+"transform: perspective(400px) rotateX(10deg);}","100% {"+x+"transform: perspective(400px) rotateX(0deg);opacity: 1;}","}"].join("");break;case"flipY":v=["@"+y+"keyframes outLeft {","0% {"+x+"transform: perspective(400px) rotateY(0deg);opacity: 1;}","100% {"+x+"transform: perspective(400px) rotateY(90deg);opacity: 0;}","}","@"+y+"keyframes inLeft {","0% {"+x+"transform: perspective(400px) rotateY(90deg);opacity: 0;}","40% {"+x+"transform: perspective(400px) rotateY(-10deg);}","70% {"+x+"transform: perspective(400px) rotateY(10deg);}","100% {"+x+"transform: perspective(400px) rotateY(0deg);opacity: 1;}","}","@"+y+"keyframes outRight {","0% {"+x+"transform: perspective(400px) rotateY(0deg);opacity: 1;}","100% {"+x+"transform: perspective(400px) rotateY(-90deg);opacity: 0;}","}","@"+y+"keyframes inRight {","0% {"+x+"transform: perspective(400px) rotateY(90deg);opacity: 0;}","40% {"+x+"transform: perspective(400px) rotateY(-10deg);}","70% {"+x+"transform: perspective(400px) rotateY(10deg);}","100% {"+x+"transform: perspective(400px) rotateY(0deg);opacity: 1;}","}"].join("");break}var w=[".glisse-transitionOut-next {",y+"animation: "+e.settings.changeSpeed+"ms ease;",y+"animation-name: outLeft;",y+"animation-fill-mode: both;","}",".glisse-transitionIn-prev {",y+"animation: "+e.settings.changeSpeed+"ms ease;",y+"animation-name: inLeft;",y+"animation-fill-mode: both;","}",".glisse-transitionOut-prev {",y+"animation: "+e.settings.changeSpeed+"ms ease;",y+"animation-name: outRight;",y+"animation-fill-mode: both;","}",".glisse-transitionIn-next {",y+"animation: "+e.settings.changeSpeed+"ms ease;",y+"animation-name: inRight;",y+"animation-fill-mode: both;","}"].join("");a('<style type="text/css" id="glisse-css">'+v+w+"</style>").appendTo("head")};var g=function g(){var v=a('img[data-glisse-big="'+m+'"]');if(!v.parent().next().find("img[rel="+i+"]").length){e.els.controls.find(".glisse-next").addClass("ended")}else{e.els.controls.find(".glisse-next").removeClass("ended")}if(!v.parent().prev().find("img[rel="+i+"]").length){e.els.controls.find(".glisse-prev").addClass("ended")}else{e.els.controls.find(".glisse-prev").removeClass("ended")}};var j=function j(){var w=e.els.controls.find(".glisse-legend");var v=a('img[data-glisse-big="'+m+'"]');var x=v.attr("title");w.html((x)?x:"")};var f=function f(v){if(v){e.els.overlay.addClass("loading")}else{e.els.overlay.removeClass("loading")}};var r=function r(z){var y=["Moz","Khtml","Webkit","O","ms"],x=document.createElement("div"),w=z.charAt(0).toUpperCase()+z.slice(1);for(var v=y.length;v--;){if((y[v]+w) in x.style){return("-"+y[v].toLowerCase()+"-")}}return false};var t=(function(){return{observe:function(x,w){var v=setInterval(function(){if(document.getElementById(x)){w(document.getElementById(x));clearInterval(v)}},60)}}})();var s=function s(x){if(x.type=="touchstart"){mobile.touching=true;if(x.touches.length==1){e.els.content.css(r("transition")+"transition","");var y=x.touches[0];if(y.target.onclick){y.target.onclick()}mobile.oX=y.pageX;mobile.nX=0;mobile.scrollX=0}}else{if(x.type=="touchmove"){x.preventDefault();mobile.scrollX=null;if(x.touches.length==1){var y=x.touches[0];mobile.nX=y.pageX;if(mobile.oX>mobile.nX){mobile.scrollX=-(mobile.oX-mobile.nX)}else{if(mobile.nX>mobile.oX){mobile.scrollX=mobile.nX-mobile.oX}}e.els.content.css(r("transform")+"transform","translateX("+(mobile.scrollX)+"px)")}}else{if(x.type=="touchend"||x.type=="touchcancel"){mobile.touching=false;var w=r("transition")+"transition",v="opacity "+e.settings.speed+"ms ease, "+r("transform")+"transform "+e.settings.speed+"ms ease";e.els.content.css(w,v);if(mobile.scrollX>140){n("prev")}else{if(mobile.scrollX<-(140)){n("next")}else{e.els.content.css(r("transform")+"transform","translateX(0px)")}}}else{}}}};e.init()};a.fn.glisse=function(b){return this.each(function(){if(undefined===a(this).data("glisse")){var c=new a.glisse(this,b);a(this).data("glisse",c)}})}})(jQuery);